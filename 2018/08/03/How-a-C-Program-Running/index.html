<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Verdana:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="compile,link,load,execute," />










<meta name="description" content="The process is based on the X86-64 linux or Unix system. The principle of other system is similar. When a C programming language file named hello.c would like to run on a X86-64 linux computer, it usu">
<meta name="keywords" content="compile,link,load,execute">
<meta property="og:type" content="article">
<meta property="og:title" content="How a C Program Running">
<meta property="og:url" content="http://memdreams.github.io/2018/08/03/How-a-C-Program-Running/index.html">
<meta property="og:site_name" content="Dreams&#39; Inn">
<meta property="og:description" content="The process is based on the X86-64 linux or Unix system. The principle of other system is similar. When a C programming language file named hello.c would like to run on a X86-64 linux computer, it usu">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-03T16:18:52.429Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How a C Program Running">
<meta name="twitter:description" content="The process is based on the X86-64 linux or Unix system. The principle of other system is similar. When a C programming language file named hello.c would like to run on a X86-64 linux computer, it usu">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://memdreams.github.io/2018/08/03/How-a-C-Program-Running/"/>





  <title>How a C Program Running | Dreams' Inn</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dreams' Inn</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Becoming a better coder</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://memdreams.github.io/2018/08/03/How-a-C-Program-Running/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jie Meng (Julie)">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dreams' Inn">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">How a C Program Running</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-03T09:59:08-04:00">
                2018-08-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Operating-System/" itemprop="url" rel="index">
                    <span itemprop="name">Operating System</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>The process is based on the X86-64 linux or Unix system. The principle of other system is similar.</p>
<p>When a C programming language file named <em>hello.c</em> would like to run on a X86-64 linux computer, it usually should go through 4 steps:</p>
<ul>
<li>Compile</li>
<li>Link</li>
<li>Load</li>
<li>Execute</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"hello world!\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Next I will illustrate them respectively.</p>
<h1 id="Compiling"><a href="#Compiling" class="headerlink" title="Compiling"></a>Compiling</h1><p>Most compilation systems provide a <em>compiler driver</em> that invoke all the compiling process and linker. Here, we use <strong>GCC</strong> driver as the example.<br>In compiling process, there are actually 3 steps for the output <strong>relocatable object file</strong>, that is _.o_ file. They are,</p>
<ul>
<li>Preprocessor (cpp)</li>
<li>C Compiler (ccl)</li>
<li>Assembler (as)</li>
</ul>
<p><strong>Preprocessor</strong> first translates the C source file <em>hello.c</em> into an ASCII intermediate file, such as <em>hello.i</em>. In the translation, preprocessor can do 4 things,</p>
<ol>
<li>Inclusion the header files;</li>
<li>Macro expansion, which replace the <code>#define</code> macros with their definitions;</li>
<li>Conditional Compilation;</li>
<li>Line control.</li>
</ol>
<p>Then the C <strong>compiler</strong> will translate the <em>hello.i</em> into an assembly-language file <em>hello.s</em>. The <strong>assembler</strong> then translates <em>hello.s</em> into a binary <em>relocatable object file</em> <em>hello.o</em>.<br>Compiler can do some optimized operation, such as replace <code>2+6</code> with 8 directly, whereas assembler translates the assembly instructions into different sections with special format in the relocatable object file. Code and Data are definitely separated into different sections which generally named <code>.text</code> and <code>.data</code> and <code>.bss</code>.<br>And in the .o file, there are also the <em>symbol table</em> and <em>relocatable text</em> and <em>data</em> sections which are used for <strong>symbol resolution</strong> and <strong>relocation</strong> respectively in the linking step.</p>
<h1 id="Linking"><a href="#Linking" class="headerlink" title="Linking"></a>Linking</h1><p>In C programming language, there is a principle that each symbol reference can only associate with exactly one symbol definition. So, <strong>symbol resolution</strong> is used for solving duplicate symbol conflict via 3 rules for judging symbols <strong>strong</strong> or <strong>weak</strong> when linking more than one .o object files which have same name symbols.</p>
<p><strong>relocation</strong> utilizes the relocatable text and data sections in .o file to insert the data and file into the .text and .data segments properly, and meanwhile, update the symbol reference in symbol table.</p>
<p>The <strong>executable object file</strong> <em>hello</em> is generated by <code>gcc -o hello hello.c</code>(the compiling process is automatically done with this command), the entry point(where the <code>main</code> function is) is assigned. After linking, all the code and data from different .o files should combine in the text and data segments, and symbol table is updated to maintain the address of all the symbols in the source file.</p>
<p>In this hello.c example, we didn’t include other customized c file, but called function <code>printf</code> including in the standard library <code>stdio</code>, which will be linked in the executable object file in linking procedure dynamically.</p>
<h1 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a>Loading</h1><p>The <strong>executable object file</strong> <em>hello</em> then need to be loaded by a <strong>loader</strong>, which adopts a method named <strong>Page Mapping</strong>.<br>There are 3 steps in loading,</p>
<ul>
<li>Create the <strong>virtual address space</strong> for <strong>process</strong>, ie. mapping structure from virtual memory address(<strong>VMA</strong>) to physical address;</li>
<li>Read header of executable object file <em>hello</em>, build the mapping relationship between <em>hello</em> and virtual address space;</li>
<li>Set CPU instruction register(usually %esp, stack pointer register) as entry point, start running.</li>
</ul>
<p>Only code and data segments will be loaded into memory. And once page is loaded successfully, the <em>hello</em> can be executed.</p>
<h1 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h1><p>When <em>hello</em> can be executed, it means its an active <em>process</em> and in the virtual memory now. In the virtual memory space, the code, data and heap are located from lowest addresses to higher ones, and  the stack is expanding from top addresses to lower ones. Between them is unused addresses and space for <em>dynamic libraries</em>, where the <code>printf</code> mentioned in linking is referenced from.</p>
<p>The <strong>stack</strong> is the core of function calls. The stack top address is stored in %esp. <strong>Stack frame</strong> in the stack stores the information for a function call, which includes,</p>
<ul>
<li>the function parameters and return address;</li>
<li>the context, such as the registers before and after the call;</li>
<li>temporary variables;</li>
<li>%esp point to top stack, %ebp(frame pointer) point to the returned function address + 4.</li>
</ul>
<p>During the calling, we have to obey a convention about the order of reading parameters, how to pop and push in the stack, and how to handle name mangling etc. Maybe I will introduce them next time.</p>
<p>Ref:</p>
<ul>
<li><strong><a href="https://blog.piasy.com/2017/10/24/I-Need-Know-About-Compile-Link-Load-Execute/" target="_blank" rel="noopener">编译链接装载运行</a></strong></li>
<li>[Computer System: A Programmer’s Perspective]</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/compile/" rel="tag"># compile</a>
          
            <a href="/tags/link/" rel="tag"># link</a>
          
            <a href="/tags/load/" rel="tag"># load</a>
          
            <a href="/tags/execute/" rel="tag"># execute</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/17/Python-Decorator/" rel="next" title="Python Decorator">
                <i class="fa fa-chevron-left"></i> Python Decorator
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Jie Meng (Julie)" />
            
              <p class="site-author-name" itemprop="name">Jie Meng (Julie)</p>
              <p class="site-description motion-element" itemprop="description">Never too late to learn.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Compiling"><span class="nav-number">1.</span> <span class="nav-text">Compiling</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linking"><span class="nav-number">2.</span> <span class="nav-text">Linking</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Loading"><span class="nav-number">3.</span> <span class="nav-text">Loading</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Execution"><span class="nav-number">4.</span> <span class="nav-text">Execution</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jie Meng (Julie)</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
